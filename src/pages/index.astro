---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Card from "@/components/Card.astro";
import Hr from "@/components/Hr.astro";
import getSortedPosts from "@/utils/getSortedPosts";
import { SITE } from "@/config";

const posts = await getCollection("blog");
const sortedPosts = getSortedPosts(posts);
const featuredPosts = sortedPosts.filter(({ data }) => data.featured);
const recentPosts = sortedPosts.filter(({ data }) => !data.featured);
// 计算总文章数
const totalPosts = posts.length;
---

<Layout>
  <Header />
  <style is:inline>
    .index-wrapper {
      width: 100%;
      max-width: 768px;
      margin: 0 auto;
      padding: 8vw 1.5rem 4vw;
    }
    .index-wrapper h1 {
      font-family: var(--font-serif);
      font-size: clamp(1.6rem, 3vw, 2.2rem);
      color: var(--accent, #8c9a5b);
      margin-bottom: 2rem;
    }
  </style>

  <main id="main-content" class="index-wrapper">
    <!-- 1. b标题 ->
    <h1 class="text-center">把书页、泥土与日常折进同一束光里。</h1>

    <!-- 2. 关于我 -->
    <section>
      <h2 class="text-lg font-semibold mb-2 border-l-2 border-accent pl-2">
        关于我
      </h2>
      <p>
        你好，我是 <b>Night Owlong</b>。<br />
        白天在课桌前胡思乱想，晚上在灯下补读书笔记。<br />
        相信知识像水，保持住才能滋养更多生命；<br />
        相信文字像光，简短也能照得很远。
      </p>
    </section>

    <!-- 3. 与我联系 -->
    <section class="mt-8">
      <h2 class="text-lg font-semibold mb-2 border-l-2 border-accent pl-2">
        与我联系
      </h2>
      <span class="block">📞 电话：<a href="tel:+8615330353774" class="link">+86 153 3035 3774</a></span>
      <span class="block">📧 邮箱：<a href="mailto:starsdusts@foxmail.com" class="link">starsdusts@foxmail.com</a></span>
      <span class="block">💾 网盘：<a href="https://pan.baidu.com/s/1zX2s0pzp1PIj-h6gTZsONA?pwd=84f2" class="link">笔记资源网盘(点击进入网盘资源)</a></span>
      <p class="mt-2 text-sm">
        欢迎来信交换书单、分享实验，或只是说一句「今天也有被治愈到」。<br />
        留言通常在 24h 内回复；若遇野外采样，请允许我多带一点泥土的气息回来。
      </p>
    </section>

    <section class="mt-8">
      <h2 class="text-lg font-semibold mb-2 border-l-2 border-accent pl-2">
        小贴士
      </h2>
      <p>
        感觉内容凌乱没有分类？别担心，点击右上角的Tags根据标签查找你感兴趣的内容！
      </p>
    </section>

    <footer class="mt-12 text-sm text-center text-secondary">
      极简留白，是为了给你更多呼吸的空间。
    </footer>

    <Hr />

    <!-- 4. Featured -->
    {featuredPosts.length > 0 && (
      <section id="featured">
        <h2 class="text-xl font-semibold mb-4">Featured</h2>
        <ul>
          {featuredPosts.map(data => <Card variant="h3" {...data} />)}
        </ul>
      </section>
    )}

    <!-- 5. Recent Posts -->
    {recentPosts.length > 0 && (
      <>
        {featuredPosts.length > 0 && <Hr />}
        <section id="recent-posts">
          <h2 class="text-xl font-semibold mb-4">Recent Posts</h2>
          <ul>
            {recentPosts.map(
              (data, i) =>
                i < SITE.postPerIndex && <Card variant="h3" {...data} />
            )}
          </ul>
          
          <!-- 添加 All Posts 文字链接，包含总文章数 -->
          <div class="text-right mt-6">
            <a href="/posts" class="text-accent hover:underline font-medium">
              All Posts ({totalPosts}) >>>
            </a>
          </div>
        </section>
      </>
    )}
  </main>

  <Footer />
</Layout>
