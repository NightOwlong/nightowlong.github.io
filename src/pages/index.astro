---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Card from "@/components/Card.astro";
import Hr from "@/components/Hr.astro";
import getSortedPosts from "@/utils/getSortedPosts";
import { SITE } from "@/config";

const posts = await getCollection("blog");
const sortedPosts = getSortedPosts(posts);
const featuredPosts = sortedPosts.filter(({ data }) => data.featured);
const recentPosts = sortedPosts.filter(({ data }) => !data.featured);
---

<Layout>
  <Header />
  <!-- 仅新增一段 <style> 让主区域与 Header 同宽，其余不改动 -->
  <style is:inline>
    /* 与 Header 同宽 → max-w-3xl = 768px */
    .index-wrapper {
      width: 100%;
      max-width: 768px;
      margin: 0 auto;
      padding: 8vw 1.5rem 4vw;
    }
    /* 让诗歌标题不换行居中 */
    .index-wrapper h1 {
      font-family: var(--font-serif);
      font-size: clamp(1.6rem, 3vw, 2.2rem);
      color: var(--accent, #8c9a5b);
      margin-bottom: 2rem;
    }
    /* 其余样式沿用 Tailwind 主题，不覆盖夜间模式 */
  </style>

  <main id="main-content" class="index-wrapper">
    <!-- 1. 诗歌 -->
    <h1 class="text-center">把书页、泥土与日常折进同一束光里。</h1>

    <!-- 2. 关于我 -->
    <section>
      <h2 class="text-lg font-semibold mb-2 border-l-2 border-accent pl-2">
        关于我
      </h2>
      <p>
        你好，我是 Night Owlong。<br />
        白天在课桌前胡思乱想，晚上在灯下补读书笔记。<br />
        相信知识像水，保持住才能滋养更多生命；<br />
        相信文字像光，简短也能照得很远。
      </p>
    </section>

    <!-- 3. 与我联系 -->
    <section class="mt-8">
      <h2 class="text-lg font-semibold mb-2 border-l-2 border-accent pl-2">
        与我联系
      </h2>
      <span class="block">📞 电话：<a href="tel:+8615330353774" class="link">+86 153 3035 3774</a></span>
      <span class="block">📧 邮箱：<a href="mailto:starsdusts@foxmail.com" class="link">starsdusts@foxmail.com</a></span>
      <p class="mt-2 text-sm">
        欢迎来信交换书单、分享实验，或只是说一句「今天也有被治愈到」。<br />
        留言通常在 24h 内回复；若遇野外采样，请允许我多带一点泥土的气息回来。
      </p>
    </section>

    <footer class="mt-12 text-sm text-center text-secondary">
      极简留白，是为了给你更多呼吸的空间。
    </footer>

    <Hr />

    <!-- 4. Featured -->
    {featuredPosts.length > 0 && (
      <section id="featured">
        <h2 class="text-xl font-semibold mb-4">Featured</h2>
        <ul>
          {featuredPosts.map(data => <Card variant="h3" {...data} />)}
        </ul>
      </section>
    )}

    <!-- 5. Recent Posts -->
    {recentPosts.length > 0 && (
      <>
      <Hr />
        {featuredPosts.length > 0 && <Hr />}
        <section id="recent-posts">
          <h2 class="text-xl font-semibold mb-4">Recent Posts</h2>
          <ul>
            {recentPosts.map(
              (data, i) =>
                i < SITE.postPerIndex && <Card variant="h3" {...data} />
            )}
          </ul>
        </section>
      </>
    )}
  </main>

  <Footer />
</Layout>