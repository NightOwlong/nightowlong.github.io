---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Card from "@/components/Card.astro";
import Hr from "@/components/Hr.astro";
import getSortedPosts from "@/utils/getSortedPosts";
import { SITE } from "@/config";

const posts = await getCollection("blog");
const sortedPosts = getSortedPosts(posts);
const featuredPosts = sortedPosts.filter(({ data }) => data.featured);
const recentPosts = sortedPosts.filter(({ data }) => !data.featured);
---

<Layout>
  <Header />
  <main id="main-content" data-layout="index">
    <!-- 诗歌 -->
    <section class="pt-12 pb-6">
      <h2 class="text-2xl font-semibold tracking-wide mb-4 text-center">
        ✨ 星星与尘土 ✨
      </h2>
      <p class="whitespace-pre-line text-center">
我们是星星 ⭐，也是尘土 🌱，<br />
光年之外 🌌，或泥土深处 🕳️。<br />
某一刻燃烧 🔥，某一刻沉浮 🌊，<br />
某一夜璀璨 ✨，某一日荒芜 🍂。<br />
<br />
风带走的 💨，雨又带回 🌧️，<br />
沉默的 🤫，终将被听见 👂。<br />
若你问我永恒的模样——<br />
是沙粒 🏖️，也是火焰 🔥
      </p>
    </section>

    <Hr />

    {
      featuredPosts.length > 0 && (
        <section id="featured" class="pt-12 pb-6">
          <h2 class="text-2xl font-semibold tracking-wide">Featured</h2>
          <ul>
            {featuredPosts.map(data => <Card variant="h3" {...data} />)}
          </ul>
        </section>
      )
    }

    {
      recentPosts.length > 0 && (
        <>
          {featuredPosts.length > 0 && <Hr />}
          <section id="recent-posts" class="pt-12 pb-6">
            <h2 class="text-2xl font-semibold tracking-wide">Recent Posts</h2>
            <ul>
              {recentPosts.map(
                (data, i) =>
                  i < SITE.postPerIndex && <Card variant="h3" {...data} />
              )}
            </ul>
          </section>
        </>
      )
    }
  </main>
  <Footer />
</Layout>